[https://mp.weixin.qq.com/s/6l0TbRYSHgtgzfuZZigU-A](https://mp.weixin.qq.com/s/6l0TbRYSHgtgzfuZZigU-A)

# å‰è¨€
è¿™æ˜¯ä¸€é“é¢è¯•é¢˜ï¼Œè¿™ä¸ªé—®é¢˜å‡ºæ¥çš„ä¸€åˆ¹é‚£ï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°çš„å°±æ˜¯forå¾ªç¯100000æ¬¡å§ï¼Œä½†æ˜¯è¿™æ–¹æ¡ˆç€å®è®©æµè§ˆå™¨å´©æºƒå•Šï¼è¿˜æœ‰ä»€ä¹ˆè§£å†³æ–¹æ¡ˆå‘¢ï¼Ÿ
# æ­£æ–‡
## 1. for å¾ªç¯100000æ¬¡
è™½è¯´forå¾ªç¯æœ‰ç‚¹lowï¼Œä½†æ˜¯ï¼Œå½“é¢è¯•å®˜é—®ï¼Œä¸ºä»€ä¹ˆä¼šè®©æµè§ˆå™¨å´©æºƒçš„æ—¶å€™ï¼Œä½ çŸ¥é“å’‹è§£é‡Šå—ï¼Ÿ
æ¥ä¸ªä¾‹å­å§ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸€ä¸ªå®¹å™¨ï¼ˆulï¼‰ä¸­å­˜æ”¾100000é¡¹æ•°æ®ï¼ˆliï¼‰ï¼š
æˆ‘ä»¬çš„æ€è·¯æ˜¯æ‰“å°**jsè¿è¡Œæ—¶é—´**å’Œ**é¡µé¢æ¸²æŸ“æ—¶é—´**ï¼Œç¬¬ä¸€ä¸ªconsole.logçš„è§¦å‘æ—¶é—´æ˜¯åœ¨é¡µé¢è¿›è¡Œæ¸²æŸ“ä¹‹å‰ï¼Œæ­¤æ—¶å¾—åˆ°çš„é—´éš”æ—¶é—´ä¸ºJSè¿è¡Œæ‰€éœ€è¦çš„æ—¶é—´ï¼›ç¬¬äºŒä¸ªconsole.logæ˜¯åœ¨ setTimeout ä¸­çš„ï¼Œå®ƒçš„è§¦å‘æ—¶é—´æ˜¯åœ¨æ¸²æŸ“å®Œæˆï¼Œåœ¨ä¸‹ä¸€æ¬¡Event Loopä¸­æ‰§è¡Œçš„ã€‚
```
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <ul id="ul"></ul>

  <script>
    let now = Date.now();  //Date.now()å¾—åˆ°æ—¶é—´æˆ³

    const total = 100000
    const ul = document.getElementById('ul')

    for (let i = 0; i < total; i++) {
      let li = document.createElement('li')
      li.innerHTML = ~~(Math.random() * total) 
      ul.appendChild(li)
    }
    console.log('jsè¿è¡Œæ—¶é—´',Date.now()-now);

    setTimeout(()=>{  
      console.log('æ€»æ—¶é—´',Date.now()-now);
    },0)
    console.log();
  </script>
</body>

</html>
```
è¿è¡Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªæ•°æ®ï¼š
![](https://cdn.nlark.com/yuque/0/2023/png/991609/1699608775580-89f0e131-7a7f-44fb-b17d-1c7833a0ce04.png#averageHue=%23f6f6f5&clientId=uc0c98e00-251d-4&from=paste&id=u2b033b47&originHeight=230&originWidth=607&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=ubdb0b407-4b23-490a-89ab-6fa308f4707&title=)
image.png

è¿™æ¸²æŸ“å¼€é”€ä¹Ÿå¤ªå¤§äº†å§ï¼è€Œä¸”å®ƒæ˜¯åä¸‡æ¡æ•°æ®ä¸€èµ·åŠ è½½å‡ºæ¥ï¼Œæ²¡åŠ è½½å®Œæˆæˆ‘ä»¬çœ‹åˆ°çš„ä¼šæ˜¯ä¸€ç›´**ç™½å±**ï¼›åœ¨æˆ‘ä»¬å‘ä¸‹æ»‘åŠ¨è¿‡ç¨‹ä¸­ï¼Œé¡µé¢ä¹Ÿä¼šæœ‰**å¡é¡¿ç™½å±**ç°è±¡ï¼Œè¿™å°±éœ€è¦æ–°çš„æ–¹æ¡ˆäº†ã€‚ç»§ç»­çœ‹ï¼
## 2. å®šæ—¶å™¨
æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®šæ—¶å™¨å®ç°åˆ†é¡µæ¸²æŸ“ï¼Œæˆ‘ä»¬ç»§ç»­æ‹¿ä¸Šé¢é‚£ä»½ä»£ç è¿›è¡Œä¼˜åŒ–ï¼š
```
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <ul id="ul"></ul>

  <script>
    let now = Date.now();  //Date.now()å¾—åˆ°æ—¶é—´æˆ³

    const total = 100000  //æ€»å…±100000æ¡æ•°æ®
    const once = 20  //æ¯æ¬¡æ’å…¥20æ¡
    const page = total / once  //æ€»é¡µæ•°
    let index = 1
    const ul = document.getElementById('ul')

    function loop(curTotal, curIndex) {
      if (curTotal <= 0) {  åˆ¤æ–­æ€»æ•°å±…æ¡æ•°æ˜¯å¦å°äºç­‰äº0
        return false
      }
      let pageCount = Math.min(curTotal, once)  //ä»¥ä¾¿é™¤ä¸å°½æœ‰ä½™æ•°
      setTimeout(() => {
        for (let i = 0; i < pageCount; i++) {
          let li = document.createElement('li')
          li.innerHTML = curIndex + i + ':' + ~~(Math.random() * total) 
          ul.appendChild(li)
        }
        loop(curTotal - pageCount, curIndex + pageCount)
      }, 0)
    }
    loop(total, index)
  </script>
</body>

</html>
```
è¿è¡Œåå¯ä»¥çœ‹åˆ°è¿™åä¸‡æ¡æ•°æ®å¹¶**ä¸æ˜¯ä¸€æ¬¡æ€§**å…¨éƒ¨åŠ è½½å‡ºæ¥ï¼Œæµè§ˆå™¨å³æ–¹çš„ä¸‹æ‹‰æ¡æœ‰**é¡ºæ»‘**çš„æ•ˆæœå“¦ï¼Œå¦‚ä¸‹å›¾ï¼š
![](https://cdn.nlark.com/yuque/0/2023/gif/991609/1699608775464-1e80c3eb-1c7f-4bbd-b27d-48454ccd03ef.gif#averageHue=%23fcfcfb&clientId=uc0c98e00-251d-4&from=paste&id=u56cbb7d3&originHeight=284&originWidth=640&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u9bfeba46-706f-491e-99fe-63f082ec129&title=)
è¿›åº¦æ¡.gif

ä½†æ˜¯å½“æˆ‘ä»¬å¿«é€Ÿæ»šåŠ¨æ—¶ï¼Œé¡µé¢è¿˜æ˜¯ä¼šæœ‰**ç™½å±**ç°è±¡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ
![](https://cdn.nlark.com/yuque/0/2023/gif/991609/1699608775462-6acd95bd-2adf-40fa-8730-7f88cd798281.gif#averageHue=%23fcfbfb&clientId=uc0c98e00-251d-4&from=paste&id=u00b0936c&originHeight=355&originWidth=640&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=uff54219d-fb76-4643-b732-bce137733ed&title=)
st.gif
å¯ä»¥è¯´æœ‰ä¸¤ç‚¹åŸå› ï¼š

- â€¢ ä¸€æ˜¯setTimeoutçš„æ‰§è¡Œæ—¶é—´æ˜¯ä¸ç¡®å®šçš„ï¼Œå®ƒå±äºå®ä»»åŠ¡ï¼Œéœ€è¦ç­‰åŒæ­¥ä»£ç ä»¥åŠå¾®ä»»åŠ¡æ‰§è¡Œå®Œåæ‰§è¡Œã€‚
- â€¢ äºŒæ˜¯å±å¹•åˆ·æ–°é¢‘ç‡å—åˆ†è¾¨ç‡å’Œå±å¹•å°ºå¯¸å½±å“ï¼Œè€ŒsetTimeoutåªèƒ½è®¾ç½®ä¸€ä¸ªå›ºå®šçš„æ—¶é—´é—´éš”ï¼Œè¿™ä¸ªæ—¶é—´ä¸ä¸€å®šå’Œå±å¹•åˆ·æ–°æ—¶é—´ç›¸åŒã€‚
## 3. requestAnimationFrame

- æˆ‘ä»¬è¿™æ¬¡é‡‡ç”¨requestAnimationFrameçš„æ–¹æ³•ï¼Œå®ƒæ˜¯ä¸€ä¸ªç”¨äºåœ¨ä¸‹ä¸€æ¬¡æµè§ˆå™¨**é‡ç»˜ä¹‹å‰**è°ƒç”¨æŒ‡å®šå‡½æ•°çš„æ–¹æ³•ï¼Œå®ƒæ˜¯ HTML5 æä¾›çš„ APIã€‚æˆ‘ä»¬æ’å…¥ä¸€ä¸ªå°çŸ¥è¯†ç‚¹ï¼Œ requestAnimationFrame å’Œ setTimeout çš„åŒºåˆ«ï¼š
Â· requestAnimationFrameçš„è°ƒç”¨é¢‘ç‡é€šå¸¸ä¸ºæ¯ç§’60æ¬¡ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨**æ¯æ¬¡é‡ç»˜ä¹‹å‰æ›´æ–°**åŠ¨ç”»çš„çŠ¶æ€ï¼Œå¹¶ç¡®ä¿åŠ¨ç”»æµç•…è¿è¡Œï¼Œè€Œä¸ä¼šå¯¹æµè§ˆå™¨çš„æ€§èƒ½é€ æˆå½±å“ã€‚
Â· setIntervalä¸setTimeoutå®ƒå¯ä»¥è®©æˆ‘ä»¬åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…é‡å¤æ‰§è¡Œä¸€ä¸ªæ“ä½œï¼Œ**ä¸è€ƒè™‘æµè§ˆå™¨çš„é‡ç»˜**ï¼Œè€Œæ˜¯æŒ‰ç…§**æŒ‡å®šçš„æ—¶é—´é—´éš”**æ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œå¯èƒ½ä¼šè¢«å»¶è¿Ÿæ‰§è¡Œï¼Œä»è€Œå½±å“åŠ¨ç”»çš„æµç•…åº¦ã€‚

è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¤šæ¬¡åˆ›å»ºliæŒ‚åˆ°ulä¸Šï¼Œè¿™æ ·ä¼šå¯¼è‡´**å›æµ**ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨**è™šæ‹Ÿæ–‡æ¡£ç‰‡æ®µ**çš„æ–¹å¼å»ä¼˜åŒ–å®ƒï¼Œå› ä¸ºå®ƒä¸ä¼šè§¦å‘DOMæ ‘çš„é‡æ–°æ¸²æŸ“ï¼
```
<!DOCTYPE html>
<html lang="en">

![rf.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3eab42b37f53408b981411ee54088d5a~tplv-k3u1fbpfcp-watermark.image?)
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

![st.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3e922cc57a044f5e9e48e58bda5f6756~tplv-k3u1fbpfcp-watermark.image?)
<body>
  <ul id="ul"></ul>

  <script>
    let now = Date.now();  //Date.now()å¾—åˆ°æ—¶é—´æˆ³

    const total = 10000
    const once = 20
    const page = total / once
    let index = 1
    const ul = document.getElementById('ul')

    function loop(curTotal, curIndex) {
      if (curTotal <= 0) {
        return false
      }
      let pageCount = Math.min(curTotal, once)  //ä»¥ä¾¿é™¤ä¸å°½æœ‰ä½™æ•°
      requestAnimationFrame(()=>{
        let fragment = document.createDocumentFragment() //è™šæ‹Ÿæ–‡æ¡£
        for (let i = 0; i < pageCount; i++) {
          let li = document.createElement('li')
          li.innerHTML = curIndex + i + ':' + ~~(Math.random() * total)  
          fragment.appendChild(li)
        }
        ul.appendChild(fragment)
        loop(curTotal - pageCount, curIndex + pageCount)
      })
    }
    loop(total, index)
  </script>
</body>

</html>
```
å¯ä»¥çœ‹åˆ°å®ƒç™½å±æ—¶é—´æ²¡æœ‰é‚£ä¹ˆé•¿äº†ï¼š
![](https://cdn.nlark.com/yuque/0/2023/gif/991609/1699608775515-7f72fef3-850c-48d2-aa93-ef2f6167f57c.gif#averageHue=%23fdfcfc&clientId=uc0c98e00-251d-4&from=paste&id=uebabfab9&originHeight=355&originWidth=640&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u0195ec9d-6509-4bd2-b9df-e159a300ace&title=)
rqf.gif

è¿˜æœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ¡ˆå‘¢ï¼Ÿå½“ç„¶æœ‰ï¼å¾€ä¸‹çœ‹ï¼
## 4. è™šæ‹Ÿåˆ—è¡¨
æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™å¼ å›¾æ¥è¡¨ç¤º**è™šæ‹Ÿåˆ—è¡¨**ï¼Œ**çº¢æ¡†**ä»£è¡¨ä½ çš„**æ‰‹æœº**ï¼Œ**é»‘æ¡**ä»£è¡¨**ä¸€æ¡æ¡æ•°æ®**ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/991609/1699608775532-6bb83feb-c09a-4995-a559-b79bfddd2028.png#averageHue=%23dbd6d6&clientId=uc0c98e00-251d-4&from=paste&id=u661c059e&originHeight=698&originWidth=631&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=ubdd36482-bc20-44af-bfbb-6d18e9985dd&title=)
æ€è·¯ï¼šæˆ‘ä»¬åªè¦çŸ¥é“æ‰‹æœºå±å¹•æœ€å¤šèƒ½æ”¾ä¸‹å‡ æ¡æ•°æ®ï¼Œå½“ä¸‹æ‹‰æ»‘åŠ¨æ—¶ï¼Œé€šè¿‡åŒæŒ‡é’ˆçš„æ–¹å¼æˆªå–ç›¸åº”çš„æ•°æ®å°±å¯ä»¥äº†ã€‚
ğŸš© **PS**:ä¸ºäº†é˜²æ­¢æ»‘åŠ¨è¿‡å¿«å¯¼è‡´çš„ç™½å±ç°è±¡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é¢„åŠ è½½çš„æ–¹å¼å¤šåŠ è½½ä¸€äº›æ•°æ®å‡ºæ¥ã€‚
ä»£ç å¦‚ä¸‹ï¼š
```
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <title>è™šæ‹Ÿåˆ—è¡¨</title>
  <style>
    .v-scroll {
      height: 600px;
      width: 400px;
      border: 3px solid #000;
      overflow: auto;
      position: relative;
      -webkit-overflow-scrolling: touch;
    }

    .infinite-list {
      position: absolute;
      left: 0;
      top: 0;
      right: 0;
      z-index: -1;
    }

    .scroll-list {
      left: 0;
      right: 0;
      top: 0;
      position: absolute;
      text-align: center;
    }

    .scroll-item {
      padding: 10px;
      color: #555;
      box-sizing: border-box;
      border-bottom: 1px solid #999;
    }
  </style>
</head>

<body>
  <div id="app">
    <div ref="list" class="v-scroll" @scroll="scrollEvent($event)">
      <div class="infinite-list" :style="{ height: listHeight + 'px' }"></div>
      
      <div class="scroll-list" :style="{ transform: getTransform }">
        <div ref="items" class="scroll-item" v-for="item in visibleData" :key="item.id"
          :style="{ height: itemHeight + 'px',lineHeight: itemHeight + 'px' }">{{ item.msg }}</div>
      </div>
    </div>
  </div>

  <script>
    var throttle = (func, delay) => {  //èŠ‚æµ
      var prev = Date.now();
      return function () {
        var context = this;
        var args = arguments;
        var now = Date.now();
        if (now - prev >= delay) {
          func.apply(context, args);
          prev = Date.now();
        }
      }
    }
    let listData = []
    for (let i = 1; i <= 10000; i++) {
      listData.push({
        id: i,
        msg: i + ':' + Math.floor(Math.random() * 10000)
      })
    }

    const { createApp } = Vue
    createApp({
      data() {
        return {
          listData: listData,
          itemHeight: 60,
          //å¯è§†åŒºåŸŸé«˜åº¦
          screenHeight: 600,
          //åç§»é‡
          startOffset: 0,
          //èµ·å§‹ç´¢å¼•
          start: 0,
          //ç»“æŸç´¢å¼•
          end: null,
        };
      },
      computed: {
        //åˆ—è¡¨æ€»é«˜åº¦
        listHeight() {
          return this.listData.length * this.itemHeight;
        },
        //å¯æ˜¾ç¤ºçš„åˆ—è¡¨é¡¹æ•°
        visibleCount() {
          return Math.ceil(this.screenHeight / this.itemHeight)
        },
        //åç§»é‡å¯¹åº”çš„style
        getTransform() {
          return `translate3d(0,${this.startOffset}px,0)`;
        },
        //è·å–çœŸå®æ˜¾ç¤ºåˆ—è¡¨æ•°æ®
        visibleData() {
          return this.listData.slice(this.start, Math.min(this.end, this.listData.length));
        }
      },
      mounted() {
        this.start = 0;
        this.end = this.start + this.visibleCount;
      },
      methods: {
        scrollEvent() {
          //å½“å‰æ»šåŠ¨ä½ç½®
          let scrollTop = this.$refs.list.scrollTop;
          //æ­¤æ—¶çš„å¼€å§‹ç´¢å¼•
          this.start = Math.floor(scrollTop / this.itemHeight);
          //æ­¤æ—¶çš„ç»“æŸç´¢å¼•
          this.end = this.start + this.visibleCount;
          //æ­¤æ—¶çš„åç§»é‡
          this.startOffset = scrollTop - (scrollTop % this.itemHeight);
        }
      }
    }).mount('#app')
  </script>
</body>

</html>
```
å¯ä»¥çœ‹åˆ°ç™½å±ç°è±¡è§£å†³äº†ï¼
![](https://cdn.nlark.com/yuque/0/2023/gif/991609/1699608776138-049ae8f2-20c4-4e85-9dff-6d39e7816f95.gif#averageHue=%23f7f7f7&clientId=uc0c98e00-251d-4&from=paste&id=u920bf47b&originHeight=922&originWidth=620&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=ud28162a7-239f-4b63-90bb-f9b7e5bdc7a&title=)
# ç»“è¯­
è§£å†³åä¸‡æ¡æ•°æ®æ¸²æŸ“çš„æ–¹æ¡ˆåŸºæœ¬éƒ½åœ¨è¿™å„¿äº†ï¼Œè¿˜æœ‰æ›´å¥½çš„æ–¹æ¡ˆç­‰å¾…å¤§ä½¬è¾“å‡ºï¼
