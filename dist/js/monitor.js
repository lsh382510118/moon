function drawAllLine(){for(var t=$(".server"),e=0;e<t.length;e++){var n=$(t[e]).attr("topoint");";"==n.charAt(n.length-1)&&(n=n.substring(0,n.length-1));for(var o=n.split(";"),a=0;a<o.length;a++){linedraw($(t[e]),$("#"+o[a]),1)}}}function linedraw(t,e,n){var o=getpoint(t),a=getpoint(e),i=o.id+"To"+a.id,l=(a.y-o.y)/(a.x-o.x),r=180/(Math.PI/Math.atan(l));a.x<o.x&&(r+=180);var s=Math.sqrt(Math.abs((a.y-o.y)*(a.y-o.y)+(a.x-o.x)*(a.x-o.x))),d=(a.r,'<div id="'+i+'" class="moveLine-box" style="left:'+o.x+"px;top:"+o.y+"px;width:"+s+"px;transform: rotate("+r+'deg);"><div class="moveLine"><div class="moveBall " style="left:'+o.r+'px"> </div></div></div>');$(".monitor").append(d);$("#"+t.attr("id")+"To"+e.attr("id")+" .moveBall");$(".moveLine-box").each((function(){ballround($(this))}))}function refresh(t){for(var e=getpoint(t).id,n=$(".moveLine-box[id*="+e+"]"),o=n.length,a=0;a<o;a++){var i=$(n[a]);if(twoLineid=i.attr("id").split("To"),twoLineid[0]==e){var l=getpoint($("#"+twoLineid[0])),r=getpoint($("#"+twoLineid[1]));i.css("transform-origin","top left");var s=(r.y-l.y)/(r.x-l.x),d=180/(Math.PI/Math.atan(s));r.x<l.x&&(d+=180);p=Math.sqrt(Math.abs((r.y-l.y)*(r.y-l.y)+(r.x-l.x)*(r.x-l.x))),r.r;i.css({transform:"rotate("+d+"deg)",width:p,left:l.x,top:l.y})}else{l=getpoint($("#"+twoLineid[1])),s=((r=getpoint($("#"+twoLineid[0]))).y-l.y)/(r.x-l.x),d=180/(Math.PI/Math.atan(s))-180;r.x<l.x&&(d+=180);var p;p=Math.sqrt(Math.abs((r.y-l.y)*(r.y-l.y)+(r.x-l.x)*(r.x-l.x))),r.r;i.css({transform:"rotate("+d+"deg)",width:p,left:r.x,top:r.y})}i.children(".moveLine").children(".moveBall"),t.attr("id");ballround(i)}}function ballround(t){var e=t.attr("id")+"_int";window.clearInterval(e);var n=t.attr("id").split("To");e=setInterval((function(){var e=getpoint($("#"+n[0])),o=getpoint($("#"+n[1])),a=t.children("div").children(".moveBall"),i=Math.sqrt(Math.abs((o.y-e.y)*(o.y-e.y)+(o.x-e.x)*(o.x-e.x))),l=1e3*i/100,r=i-o.r;a.css({transition:"all "+l+"ms linear",left:r+2}),parseInt(a.css("left"))>r&&(a.css({transition:"all 0ms linear",left:r}),a.css("left",e.r),setTimeout((function(){a.css({transition:"all "+l+"ms linear",left:r+2})}),1))}),500)}$((function(){$(".add-point button").click((function(){$(".point-opre").hasClass("show")||$(".point-opre").addClass("show"),$(".point-opre-panel:not(.add-panel)").addClass("hid"),$(".add-panel").addClass("on"),setTimeout((function(){$(".point-opre-panel.hid").removeClass("hid").removeClass("on")}),500)})),$(".del-point button").click((function(){for(var t=$(".server.sel"),e=0;e<t.length;e++){var n=$(t[e]).attr("id");$(".moveLine-box[id*="+n+"]").remove()}$(".server.sel").remove()})),$(".edit-point button").click((function(){$(".point-opre").hasClass("show")||$(".point-opre").addClass("show"),$(".point-opre-panel:not(.edit-panel)").addClass("hid"),$(".edit-panel").addClass("on"),setTimeout((function(){$(".point-opre-panel.hid").removeClass("hid").removeClass("on")}),500)})),$(".point-opre-mark").click((function(){$(".point-opre").removeClass("show")})),$(".btn-addpoint").click((function(){$(".addrelation-panel").removeClass("on");var t=new Array;t=$(".addrelation-panel .newpoint.sel");for(var e="",n=0;n<t.length;n++)e=e+$(t[n]).attr("tempid")+";";var o='<input type="hidden" value="'+e+'" class="temp-pointrelation"/>';$("body").append(o);$(".addpoint-list-box .newpoint.sel");var a=$(".add-panel .newpoint.sel").children("p").html(),i=$(".add-panel .newpoint.sel").attr("tempid"),l="",r=$(".temp-pointrelation").val(),s=10,d=10;""==l&&(l=1),""!=r&&null!=r||(r=""),""==s&&(s=10),""==d&&(d=10),""==i||null==i?""==a?alert("请输入新增节点的id和名称"):alert("请输入新增节点的id"):(addP(i,a,l,s,d,r),$("#"+i).dragDiv(10,10)),$(".point-opre-panel").removeClass("on").removeClass("hid"),$(".point-opre").removeClass("show");for(n=0;n<t.length;n++){linedraw($("#"+i),$("#"+$(t[n]).attr("tempid")),l)}}))}));var addPoint=function(t,e){for(var n=t.pointGroup,o=(t.pointRelation,n.length),a=0;a<o;a++){for(var i=n[a].id,l=n[a].name,r=n[a].state,s=n[a].top,d=n[a].left,p="",v=0;v<n[a].toP.length;v++)p=p+n[a].toP[v].toPointId+";";addP(i,l,r,s,d,p)}},addP=function(t,e,n,o,a,i){var l="";l=l+'<div class="server shadow-spread '+(0==n?"state-err":"")+'" state="'+n+'"  toPoint="'+i+'"  id="'+t+'" style="top: '+o+"px;left: "+a+'px;"><p>'+e+"</p></div>",$(".monitor").append(l),delSign($("#"+t))},addNewPoint=function(t,e){for(var n=t.length,o=0;o<n;o++){var a=t[o].id,i=t[o].name,l=(t[o].state,t[o].top,t[o].left,"");l=l+'<div class="newpoint" tempid="'+a+'1"><p>'+i+"</p></div>",$(".add-panel .addpoint-list").append(l)}},addRelaPoint=function(t,e){for(var n=t.length,o=0;o<n;o++){var a=t[o].id,i=t[o].name,l=(t[o].state,t[o].top,t[o].left,"");l=l+'<div class="newpoint" tempid="'+a+'"><p>'+i+"</p></div>",$(".addrelation-panel .addpoint-list").append(l)}},newpoint=function(t){$(".addrelation-panel .newpoint").removeClass("sel"),$(".add-panel .newpoint").removeClass("sel"),t.toggleClass("sel");var e=t.children("p").html();$(".addrelation-panel").removeClass("on").addClass("on"),$(".addrelation-panel .point-opre-title").html("请选择"+e+"所要联系的节点")},getpoint=function(t){var e=$(".server").width()/2;return{id:t.attr("id"),x:parseInt(t.css("left"))+e,y:parseInt(t.css("top"))+e,r:e}},delSign=function(t){t.click((function(){$(this).toggleClass("sel"),console.info("sel")})),t.mouseover((function(){console.info($(this).position().left);var t=$(this).children("p").html();$(".pointDetail-title").html(t),$(".pointDetail").addClass("show")})),t.mouseout((function(){$(".pointDetail").removeClass("show")}))};