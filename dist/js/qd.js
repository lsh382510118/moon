function drawActive(t,a){var e=0,n=parseInt($(".server").width())/2;setInterval((function(){a.clearRect(0,0,1e3,1e3),e++;for(var t=$(".server"),o=0;o<t.length;o++){var s=$(t[o]).attr("topoint");";"==s.charAt(s.length-1)&&(s=s.substring(0,s.length-1));for(var i=s.split(";"),r=0;r<i.length;r++){var l=$(t[o]),p=$("#"+i[r]),d=parseInt($(l).position().left)+n,c=parseInt($(l).position().top)+n,h=parseInt($(p).position().left)+n,v=parseInt($(p).position().top)+n,f=p.attr("state"),C=l.attr("state");if(1==f&&1==C)var u=1;else u=0;dynamicline(d,c,h,v,n,a,e,u)}}}),30)}function dynamicline(t,a,e,n,o,s,i,r){var l=(n-a)/(e-t),p=a-l*t,d=Math.atan(l),c=(1-Math.tan(d/2)*Math.tan(d/2))/(1+Math.tan(d/2)*Math.tan(d/2)),h=t>e?-parseInt(c*o):parseInt(c*o);i%=Math.abs(e-t)-o;var v=(i=e>t?i:-i)+t+h,f=v*l+p,$=ctx.createRadialGradient(v,f,2,v,f,5);1==r?($.addColorStop(0,"rgba(255,255,255,0.8)"),$.addColorStop(.8,"rgba(182,224,255,0.2)"),$.addColorStop(1,"rgba(182,224,255,0.0)")):($.addColorStop(0,"rgba(255, 54, 48,0.8)"),$.addColorStop(.8,"rgba(255, 54, 48,0.2)"),$.addColorStop(1,"rgba(255, 54, 48,0.0)")),s.beginPath(),s.arc(v,f,5,0,2*Math.PI,!0),s.fillStyle=$,s.fill()}function drawAllLine(t,a){setInterval((function(){a.clearRect(0,0,1e3,1e3);for(var t=$(".server"),e=0;e<t.length;e++){var n=$(t[e]).attr("topoint");";"==n.charAt(n.length-1)&&(n=n.substring(0,n.length-1));for(var o=n.split(";"),s=0;s<o.length;s++){var i=$(t[e]),r=$("#"+o[s]);pointToPoint(i,r,1)}}}),30)}$((function(){$(".add-point button").click((function(){$(".point-opre").hasClass("show")||$(".point-opre").addClass("show"),$(".point-opre-panel:not(.add-panel)").addClass("hid"),$(".add-panel").addClass("on"),setTimeout((function(){$(".point-opre-panel.hid").removeClass("hid").removeClass("on")}),500)})),$(".del-point button").click((function(){$(".point-opre").hasClass("show")||$(".point-opre").addClass("show"),$(".point-opre-panel:not(.del-panel)").addClass("hid"),$(".del-panel").addClass("on"),setTimeout((function(){$(".point-opre-panel.hid").removeClass("on").removeClass("hid")}),500)})),$(".edit-point button").click((function(){$(".point-opre").hasClass("show")||$(".point-opre").addClass("show"),$(".point-opre-panel:not(.edit-panel)").addClass("hid"),$(".edit-panel").addClass("on"),setTimeout((function(){$(".point-opre-panel.hid").removeClass("hid").removeClass("on")}),500)}))}));var pointToPoint=function(t,a,e){var n=$(".server").width()/2,o=parseInt(t.css("left"))+n,s=parseInt(t.css("top"))+n,i=parseInt(a.css("left"))+n,r=parseInt(a.css("top"))+n,l=t.hasClass("state-err"),p=a.hasClass("state-err");ctx.strokeStyle=l||p||0==e?"#ff3630":"#7bc2f6",ctx.save(),ctx.beginPath(),ctx.moveTo(o,s),ctx.lineTo(i,r),ctx.closePath(),ctx.lineWidth=2,ctx.stroke(),ctx.restore()},addPoint=function(t,a){for(var e=t.pointGroup,n=(t.pointRelation,e.length),o=0;o<n;o++){for(var s=e[o].id,i=e[o].name,r=e[o].state,l=e[o].top,p=e[o].left,d="",c=0;c<e[o].toP.length;c++)d=d+e[o].toP[c].toPointId+";";addP(s,i,r,l,p,d)}},addP=function(t,a,e,n,o,s){var i="";i=i+'<div class="server shadow-spread '+(0==e?"state-err":"")+'" state="'+e+'"  toPoint="'+s+'"  id="'+t+'" style="top: '+n+"px;left: "+o+'px;"><p>'+a+"</p></div>",$(".n-index").append(i)},addNewPoint=function(t,a){for(var e=t.length,n=0;n<e;n++){var o=t[n].id,s=t[n].name,i=(t[n].state,t[n].top,t[n].left,"");i=i+'<div class="newpoint" tempid="'+o+'"><p>'+s+"</p></div>",$(".add-panel .addpoint-list").append(i)}},addRelaPoint=function(t,a){for(var e=t.length,n=0;n<e;n++){var o=t[n].id,s=t[n].name,i=(t[n].state,t[n].top,t[n].left,"");i=i+'<div class="newpoint" tempid="'+o+'"><p>'+s+"</p></div>",$(".addrelation-panel .addpoint-list").append(i)}},newpoint=function(t){$(".addrelation-panel .newpoint").removeClass("sel"),$(".add-panel .newpoint").removeClass("sel"),t.toggleClass("sel");var a=t.children("p").html();$(".addrelation-panel").removeClass("on").addClass("on"),$(".addrelation-panel .point-opre-title").html("请选择"+a+"所要联系的节点")};